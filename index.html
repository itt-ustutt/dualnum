
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>hyperdual - Hyperdual numbers in python &#8212; hyperdual 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="hyperdual.HyperDual64" href="generated/hyperdual.HyperDual64.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="hyperdual-hyperdual-numbers-in-python">
<h1>hyperdual - Hyperdual numbers in python<a class="headerlink" href="#hyperdual-hyperdual-numbers-in-python" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>Using hyperdual numbers, you can compute exact derivatives of functions without writing analytical derivatives
or using numeric differentiation.</p>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<section id="first-second-and-third-derivatives">
<h3>First, second and third derivatives<a class="headerlink" href="#first-second-and-third-derivatives" title="Permalink to this headline">¶</a></h3>
<p>Let’s define a simple, scalar valued function for which we want to compute the first, second and third derivative.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sd">&quot;&quot;&quot;f&#39;(x) = 3 * x**2, f&#39;&#39;(x) = 6 * x&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
</pre></div>
</div>
<p>The function is defined just like a regular python function.
Different from a regular python function though, we use (hyper)dual numbers as arguments.
For example, to compute the first derivative at x = 2, we need to call the function with a dual number as input, setting the dual part (ε)
to 1.0.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hyperdual</span> <span class="kn">import</span> <span class="n">Dual64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Dual64</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">2 + 1ε</span>
</pre></div>
</div>
<p>Then, calling the function, the result is also a dual number, where the real part (or value)
is the result of the function that we would get by simply calling it with a floating point number,
whereas the dual part (or first derivative) contains the derivative.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span>
<span class="go">8 + 12ε</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">value</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">first_derivative</span>
<span class="go">12</span>
</pre></div>
</div>
<p>The value we used for the dual part (1.0) is not important, however,
the resulting derivatives will be multiples of the chosen value and as such we set it to unity.</p>
<p>The procedure as outlined above works fine, but you have to know what type of dual number you have to use.
E.g. for the second derivative, the function argument has to be a hyerdual number. We therefore introduce
helper functions that can be used to simply declare the order of the derivative you want to compute.</p>
<p>The same result as above can be created via</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">derive1</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="c1"># we want the first derivative</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">first_derivative</span>
<span class="go">12</span>
</pre></div>
</div>
<p>where <cite>x = derive1(2.0)</cite> constructs the correct dual number for us.</p>
<p>Let’s compute the second and third derivatives!</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hyperdual</span> <span class="kn">import</span> <span class="n">derive3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">derive3</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f(x)   = </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="se">\n</span><span class="s2">f&#39;(x)  = </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">first_derivative</span><span class="si">}</span><span class="se">\n</span><span class="s2">f&#39;&#39;(x) = </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">second_derivative</span><span class="si">}</span><span class="se">\n</span><span class="s2">f&#39;&#39;&#39;(x) = </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">third_derivative</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">f(x)    = 8 + 12v1 + 12v2 + 6v3</span>
<span class="go">f&#39;(x)   = 12.0</span>
<span class="go">f&#39;&#39;(x)  = 12.0</span>
<span class="go">f&#39;&#39;&#39;(x) = 6.0</span>
</pre></div>
</div>
</section>
<section id="partial-derivatives">
<h3>Partial derivatives<a class="headerlink" href="#partial-derivatives" title="Permalink to this headline">¶</a></h3>
<p>Hyperdual numbers can be used to compute partial derivatives of multivariate functions (functions of several real valued variables) as well.
A function that is often used as benchmark in optimization problems is the Rosenbrock function which is defined as:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[f(x,y) = (a - b)^2 + b(y - x^2)^2 \,,\]</div>
</div></blockquote>
<p>The function and its derivatives are implemented in <cite>scipy</cite>. Let’s compute the partial derivatives of the Rosenbrock function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hyperdual</span> <span class="kn">import</span> <span class="n">derive2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_der</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">derive2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="go">(0.5 + 1ε1 + 0ε2 + 0ε1ε2, 1 + 0ε1 + 1ε2 + 0ε1ε2)</span>
</pre></div>
</div>
<p><cite>derive2(0.5, 1.0)</cite> returns a tuple of hyperdual numbers where the correct non-real parts are set to unity.
Calling the Rosenbrock function with hyperdual numbers returns a hyperdual number containing the first partial derivatives and
the second partial derivative.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">rosen</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span>
<span class="go">56.5 + -151ε1 + 150ε2 + -200ε1ε2</span>
</pre></div>
</div>
<p>The field <cite>second_derivative</cite> now returns a tuple where the first value is the first partial derivative w.r.t <cite>x</cite> and the second value
is the first partial derivative w.r.t. <cite>y</cite>. We can now compare our values to the analytical solution:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">first_derivative</span><span class="p">)</span>
<span class="go">array([-151.,  150.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">d2</span> <span class="o">==</span> <span class="n">rosen_der</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]))</span>
</pre></div>
</div>
</section>
<section id="compute-partial-derivatives-of-multiple-arguments">
<h3>Compute partial derivatives of multiple arguments<a class="headerlink" href="#compute-partial-derivatives-of-multiple-arguments" title="Permalink to this headline">¶</a></h3>
<p>Consider a function that takes three arguments as input, one of which is vector valued.
Such a function is e.g. the helmholtz energy, denoted as <span class="math notranslate nohighlight">\(a\)</span>, a function important in statistical mechanics.
It is a function of the volume, <span class="math notranslate nohighlight">\(V\)</span>, the temperature, <span class="math notranslate nohighlight">\(T\)</span>, and the number of particles of possibly
multiple components, <span class="math notranslate nohighlight">\(N\)</span>. Let’s define this function (for an ideal gas) and compute some interesting properties.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hyperdual</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="mf">300.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="mf">20.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">39.948e-3</span><span class="p">,</span> <span class="mf">4e-3</span><span class="p">])</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">helmholtz_energy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mw</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">H</span> <span class="o">=</span> <span class="mf">6.62607015e-34</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">NAV</span> <span class="o">=</span> <span class="mf">6.02214076e23</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">RGAS</span> <span class="o">=</span> <span class="mf">8.314</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">de_broglie</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="n">NAV</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">mw</span> <span class="o">*</span> <span class="n">RGAS</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">partial_density</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">NAV</span> <span class="o">/</span> <span class="n">V</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="n">RGAS</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">partial_density</span> <span class="o">*</span> <span class="n">de_broglie</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>The specifics of the equation are not important, but note that besides <cite>t</cite> and <cite>v</cite> being scalar values,
<cite>n</cite> is a vector valued argument. Also, you can easily use mathematical expressions from <cite>numpy</cite>.</p>
<p>Now, we can compute different partial derivatives. For example, we can compute the first derivative with respect to <cite>t</cite> (temperature).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">helmholtz_energy</span><span class="p">(</span><span class="n">derive1</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mw</span><span class="p">)</span><span class="o">.</span><span class="n">first_derivative</span> <span class="c1"># negative entropy</span>
</pre></div>
</div>
<p>Or the partial derivative with respect to the values of <cite>n</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mu</span> <span class="o">=</span> <span class="n">helmholtz_energy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">derive1</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">mw</span><span class="p">)</span><span class="o">.</span><span class="n">first_derivative</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mu</span>
<span class="go">[-54192.23064420561, -46593.74696257142]</span>
</pre></div>
</div>
</section>
<section id="compatibility-with-numpy">
<h3>Compatibility with <cite>numpy</cite><a class="headerlink" href="#compatibility-with-numpy" title="Permalink to this headline">¶</a></h3>
<p>The examples shown above contain very simple mathematical equations.
We provide evaluations for a lot of useful mathematical expressions that are defined in <cite>numpy</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="go">4.497780053946161</span>
</pre></div>
</div>
<p>Calling the same function with a hyper dual number and dual parts of 1
yields the first and second derivatives. (ε1 and ε2 parts are identical)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hyperdual</span> <span class="kn">import</span> <span class="n">HyperDual64</span> <span class="k">as</span> <span class="n">HD64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">HD64</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">4.497780053946162 + 4.053427893898621ε1 + 4.053427893898621ε2 + 9.463073681596605ε1ε2</span>
</pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/hyperdual.HyperDual64.html#hyperdual.HyperDual64" title="hyperdual.HyperDual64"><code class="xref py py-obj docutils literal notranslate"><span class="pre">HyperDual64</span></code></a></p></td>
<td><p>Hyper dual number using 64-bit-floats as fields.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/hyperdual.Dual64.html#hyperdual.Dual64" title="hyperdual.Dual64"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dual64</span></code></a></p></td>
<td><p>Dual number using 64-bit-floats as fields.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">hyperdual</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="generated/hyperdual.HyperDual64.html">hyperdual.HyperDual64</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/hyperdual.Dual64.html">hyperdual.Dual64</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="generated/hyperdual.HyperDual64.html" title="next chapter">hyperdual.HyperDual64</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Philipp Rehner, Gernot Bauer.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>